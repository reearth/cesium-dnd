var w=Object.defineProperty,y=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var v=(o,i,e)=>i in o?w(o,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[i]=e,f=(o,i)=>{for(var e in i||(i={}))b.call(i,e)&&v(o,e,i[e]);if(m)for(var e of m(i))E.call(i,e)&&v(o,e,i[e]);return o},C=(o,i)=>y(o,S(i));const P=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(t){if(t.ep)return;t.ep=!0;const n=e(t);fetch(t.href,n)}};P();class h{constructor(i,e){this._initialEnableRotate=!0,this._initialEnableTranslate=!0,this._callbackProperty=new Cesium.CallbackProperty(()=>{var s;return(s=this._position)!=null?s:this._initialPosition},!1),this.cancelDragging=()=>{clearTimeout(this._timeout),this._entity&&(this._entity.position=this._initialPosition),this._entity=void 0,this._initialPosition=void 0,this._initialScreenPosition=void 0,this._timeout=void 0,this.viewer.scene.screenSpaceCameraController.enableRotate=this._initialEnableRotate,this.viewer.scene.screenSpaceCameraController.enableTranslate=this._initialEnableTranslate,this.viewer.canvas.removeEventListener("blur",this.cancelDragging)},this._handleDrag=s=>{var r;if(this._entity||this.viewer.isDestroyed()||!(s!=null&&s.position))return;const t=this._pick(s.position);if(!t)return;const n=()=>{var p,c,_;if(this._entity||this.viewer.isDestroyed())return;this._timeout=void 0,this._initialPosition=t.position,this._initialScreenPosition=s.position.clone();const a=(p=t.position)==null?void 0:p.getValue(this.viewer.clock.currentTime);if(a){const g=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(a).height;this._ellipsoid=h.enlargeEllipsoid(this.viewer.scene.globe.ellipsoid,g),this.viewer.scene.mode===Cesium.SceneMode.SCENE2D||this.viewer.scene.mode===Cesium.SceneMode.COLUMBUS_VIEW?this._initialHeight=g:this._initialHeight=void 0}const l=this._resetHeight(this._convertCartesian2ToPosition(s.position)),u=this._context(l,s.position);if(u&&((_=(c=this.options)==null?void 0:c.onDrag)==null?void 0:_.call(c,t,l,u))===!1){this._initialPosition=void 0,this._initialScreenPosition=void 0,this._ellipsoid=void 0;return}this._position=l,this._entity=t,this._initialEnableRotate=this.viewer.scene.screenSpaceCameraController.enableRotate,this._initialEnableTranslate=this.viewer.scene.screenSpaceCameraController.enableTranslate,this.viewer.scene.mode===Cesium.SceneMode.SCENE3D?this.viewer.scene.screenSpaceCameraController.enableRotate=!1:this.viewer.scene.screenSpaceCameraController.enableTranslate=!1,this.viewer.canvas.addEventListener("blur",this.cancelDragging),t.position=this._callbackProperty};if(window.clearTimeout(this._timeout),typeof((r=this.options)==null?void 0:r.dragDelay)=="undefined"){n();return}this._timeout=window.setTimeout(n,this.options.dragDelay)},this._handleDragging=s=>{var a,l;if(clearTimeout(this._timeout),!this._entity||this.viewer.isDestroyed()||!(s!=null&&s.endPosition))return;const t=this._resetHeight(this._convertCartesian2ToPosition(s.endPosition)),n=this._context(t,s.endPosition);if(!n)return;const r=(l=(a=this.options)==null?void 0:a.onDragging)==null?void 0:l.call(a,this._entity,t,C(f({},n),{previousScreenPosition:s.startPosition}));r!==!1&&(typeof r!="undefined"?this._position=r:t&&(this._position=t))},this._handleDrop=s=>{var a,l;if(clearTimeout(this._timeout),!this._entity||this.viewer.isDestroyed()||!(s!=null&&s.position))return;const t=this._entity;t.position=this._initialPosition,this._position=void 0,this._entity=void 0,this._timeout=void 0,this.viewer.scene.screenSpaceCameraController.enableRotate=this._initialEnableRotate,this.viewer.scene.screenSpaceCameraController.enableTranslate=this._initialEnableTranslate,this.viewer.canvas.removeEventListener("blur",this.cancelDragging);const n=this._resetHeight(this._convertCartesian2ToPosition(s.position)),r=this._context(n,s.position);this._initialPosition=void 0,this._initialScreenPosition=void 0,this._initialHeight=void 0,this._ellipsoid=void 0,r&&((l=(a=this.options)==null?void 0:a.onDrop)==null?void 0:l.call(a,t,n,r))!==!1&&n&&(t.position=n)},this.viewer=i,this.options=e,e!=null&&e.initialDisabled||this.enable()}get isDragging(){return!!this._entity}enable(){var i,e,s,t,n,r;this._handler=new Cesium.ScreenSpaceEventHandler(this.viewer.canvas),this._handler.setInputAction(this._handleDrag,(e=(i=this.options)==null?void 0:i.dragInputType)!=null?e:Cesium.ScreenSpaceEventType.LEFT_DOWN),this._handler.setInputAction(this._handleDragging,(t=(s=this.options)==null?void 0:s.draggingInputType)!=null?t:Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._handler.setInputAction(this._handleDrop,(r=(n=this.options)==null?void 0:n.dropInputType)!=null?r:Cesium.ScreenSpaceEventType.LEFT_UP)}disable(){var i;this.cancelDragging(),(i=this._handler)==null||i.destroy(),this._handler=void 0}get isActive(){return!!this._handler}_pick(i){var e;return(e=this.viewer.scene.pick(i))==null?void 0:e.id}_context(i,e){if(!!this._initialScreenPosition)return{position:i,screenPosition:e,initialPosition:this._initialPosition,initialScreenPosition:this._initialScreenPosition}}_convertCartesian2ToPosition(i){var e;return this.viewer.scene.camera.pickEllipsoid(i,(e=this._ellipsoid)!=null?e:this.viewer.scene.globe.ellipsoid)}_resetHeight(i){if(i&&(this.viewer.scene.mode===Cesium.SceneMode.SCENE2D||this.viewer.scene.mode===Cesium.SceneMode.COLUMBUS_VIEW)&&this._initialHeight){const e=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(i);return Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,this._initialHeight)}return i}static enlargeEllipsoid(i,e){return new Cesium.Ellipsoid(i.radii.x+e,i.radii.y+e,i.radii.z+e)}}window.CESIUM_BASE_URL="/cesium";const d=new Cesium.Viewer("cesium");d.entities.add({name:"Example1",position:Cesium.Cartesian3.fromDegrees(-100,40,1e5),box:{dimensions:new Cesium.Cartesian3(5e5,5e5,5e5),material:Cesium.Color.AQUA,outline:!0,outlineColor:Cesium.Color.AQUA}});d.entities.add({name:"Example2",position:Cesium.Cartesian3.fromDegrees(-120,30,1e3),ellipsoid:{radii:new Cesium.Cartesian3(5e5,5e5,5e5),material:Cesium.Color.WHITE}});new h(d,{onDrag:(...o)=>{console.log("drag start -------",...o)},onDrop:(...o)=>{console.log("drop ----",...o)},onDragging:(...o)=>{console.log("dragging ---",...o)}});
